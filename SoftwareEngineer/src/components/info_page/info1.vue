<template>
  <div class="chat-page">

    <!--    ÊÇ¨ÊµÆÁêÉ-->
    <div class="float-ball" ref="ball">
      <div v-if="showPetals" v-for="n in 5" :key="n" class="petal"></div>
      <div v-if="expandedMessageTip" class="expanded-message message-text markdown-body" ref="expandedMessageDiv"
           v-html="renderedText(expandedMessage)"></div>
    </div>

    <!--    ËøáÂæÄ‰ø°ÊÅØÊòæÁ§∫-->

    <div class="past-info">
      <el-button
          v-for="(ask, index) in asks"
          :key="index"
          class="question-bubble"
          @click="handleBubbleClick(index)"
          @dblclick="handleDoubleClick(index)"
          size="large"
      >
        {{ ask.user.text }}
      </el-button>
    </div>

<!--    <button @click="fileDelete">ÊÅ¢Â§ç</button>-->
    <!--    ËæìÂÖ•Ê°Ü-->
    <div class="input-container">

      <!--      ÁΩëÁªúÊåâÈíÆ-->
      <el-button type="primary" @click="sendToModel" :icon="InterIcon" size="large" style="font-size: 24px;" circle>
      </el-button>

      <input class="message-input" v-model="inputValue" placeholder="Please enter here" ref="messageInput"
             @keydown="handleKeyDown">

      <!--      ÂèëÈÄÅÊåâÈíÆ-->
      <el-button :type="sendColor" :icon="sendIcon" @click="sendToModel" size="large" style="font-size: 20px;" circle/>

      <!--      ÂõæÁâá‰∏ä‰º†ÊåâÈíÆ-->
      <el-button :type=fileColor size="large" class="dropdown-button" :icon="fileIcon" style="font-size: 20px;"
                 @click="triggerFileInput" circle/>

      <!--      ÊÇ¨ÊµÆÁ™óÊåâÈíÆ-->
      <el-button type="info" size="large" class="dropdown-button" :icon="More" style="font-size: 20px;" @click="openFloating" circle/>

      <!-- ÈöêËóèÁöÑÊñá‰ª∂ËæìÂÖ•Ê°Ü -->
      <input ref="fileInput" type="file" @change="onFileChange" style="display: none"/>

      <!-- ÊòæÁ§∫ÈÄâÊã©ÁöÑÂõæÁâá -->
      <div v-if="imageUrl">
        <img :src="imageUrl" alt="‰∏ä‰º†ÁöÑÂõæÁâá" style="max-width: 100%; height: auto;"/>
      </div>
    </div>

  </div>
</template>

<script lang="ts" setup>
import {ref, onMounted, watch, nextTick, onBeforeMount} from 'vue';
import gsap from 'gsap';
import {More, Picture, Promotion, Delete} from "@element-plus/icons-vue";
import {ElMessage} from "element-plus";
// Markdown ÈÄªËæë
import MarkdownIt from "markdown-it";
import 'highlight.js/styles/github.css'; // Á°Æ‰øùÂºïÂÖ•Ê†∑ÂºèÊñá‰ª∂
import InterIcon from '@/assets/informationPage/internet-yes.svg'
import Close from '@/assets/informationPage/close.svg'
import {useStateStore} from "@/stores/stateStore.ts";


//Ê®°ÂûãÂõûÂ§çÁöÑÂä†ËΩΩÊ†áËÆ∞
let isAILoading = ref(false)

//ËæìÂÖ•‰ø°ÊÅØ
let inputValue = ref("")
//‰ø°ÊÅØÂàóË°®
//ËøáÂéªÁöÑËØ¢ÈóÆÂàóË°®
let asks = ref([{
  "user": {text: 'What date today', internet: true, isPhoto: false, photoUrl: ''},
  "ai": {text: "19th October"}
}, {
  "user": {text: 'Tell some news', internet: true, isPhoto: false, photoUrl: ''},
  "ai": {text: "Okay, here's a quick rundown on some current events:\n" +
        "\n" +
        "**International:**\n" +
        "\n" +
        "*  **The World Cup is heating up:**   We are heading into the knockout stages in football, with incredible matches and\n" +
        "drama.  Who do you think will make it through? ‚öΩ\n" +
        "* **Global inflation remains high:** This means that prices for everyday goods are going up everywhere. üìà\n" +
        "* **Climate change is a major focus:** There are protests and discussions worldwide about how to move towards more\n" +
        "sustainable practices, with many eyes on the next UN climate summit in December. üåç\n" +
        "\n" +
        "\n" +
        "**US:**\n" +
        "\n" +
        "* **Politics is still front and center:** There are ongoing debates around several key issues, including healthcare\n" +
        "and immigration.\n" +
        "* **Elon Musk's Twitter takeover continues:**  He's making big changes to the platform and sparking mixed reactions\n" +
        "from users and experts alike. ü§î\n" +
        "**Other notable things going on:**\n" +
        "\n" +
        "* **Record-breaking weather in some places:** From wildfires in California to floods in Europe, there are extreme\n" +
        "weather events happening worldwide. üå¶Ô∏è\n" +
        "* **SpaceX continues its missions!**  We're getting closer to a future with regular space tourism and commercial lunar\n" +
        "ventures. üöÄ\n" +

        "Let me know if you want more details on any of these topics or have specific news areas you'd like me to focus on! üì∞"}
}, {
  "user": {text: 'Summarize', internet: true, isPhoto: false, photoUrl: ''},
  "ai": {text: "I will try"}
}, {
  "user": {text: 'Weather?', internet: true, isPhoto: false, photoUrl: ''},
  "ai": {
    text: 'The weather in Foshan today is looking a bit mixed:\n' +
        '\n' +
        '* **Partly sunny** with some clouds throughout the day.\n' +
        '* **High temperature:** around 28¬∞C (82¬∞F)\n' +
        '* **Low temperature:** about 21¬∞C (70¬∞F)\n' +
        '* **Windy**, so be prepared for a bit of breeze!\n' +
        '\n' +
        '\n' +
        'Enjoy your time in Foshan! üòä'
  }
}

]);

//ÁÇπÂáªÊ∞îÊ≥°‰ø°ÊÅØÂêéËæìÂá∫ÂéÜÂè≤‰ø°ÊÅØ
const handleBubbleClick = (index: number) => {
  // ËæìÂá∫ÁÇπÂáªÁöÑÊ∞îÊ≥°ÂØπÂ∫îÁöÑ ai.text
  console.log(asks.value[index].ai.text);
  expandedMessage.value = asks.value[index].ai.text;
  expandBall();
};

//ÊòæÁ§∫‰ø°ÊÅØÁöÑÂå∫Âüü
let showHTML = ref("");


//ÂèëÈÄÅ‰ø°ÊÅØ
const sendToModel = () => {
  // Â±ïÂºÄÊó∂ÂÖ≥Èó≠Â±ïÂºÄ
  if (expandedMessageTip) {
    sendNormal();
    revertBall();
    return;
  }
  if (inputValue.value === "") {
    ErrorPop("Please enter something", 2000);
    return;
  }
  asks.value.push({
    "user": {text: inputValue.value, internet: true, isPhoto: false, photoUrl: ''},
    "ai": {text: ""}
  });
  getAnswer();
  const temp_text = inputValue.value;
  inputValue.value = '';
  sendCartoon(temp_text);
  startScaling();
};


//aiËøîÂõû
const getAnswer = async () => {
  const timeout = 10000; // ËÆæÁΩÆË∂ÖÊó∂Êó∂Èó¥Ôºà‰ª•ÊØ´Áßí‰∏∫Âçï‰ΩçÔºå‰æãÂ¶Ç10ÁßíÔºâ

  const timeoutPromise = new Promise((_, reject) =>
      setTimeout(() => reject(new Error("ËØ∑Ê±ÇË∂ÖÊó∂")), timeout)
  );
  expandedMessage.value = ""//Á°Æ‰øùÊ∏ÖÁ©∫

  try {

    const response = await Promise.race([
      fetch(baseURL + "/ai/back", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          model: "gemma2:2b",
          prompt: inputValue.value,
        }),
      }),
      timeoutPromise, // Â¶ÇÊûú fetch Êú™ÂÆåÊàêÔºåÊ≠§ promise Â∞Ü‰ºòÂÖàËøîÂõûË∂ÖÊó∂ÈîôËØØ
    ]);

    if (!response.body) {
      throw new Error("ÊµÅÂºèËøîÂõûÊ≤°Êúâbody");
    }

    const reader = response.body.getReader();
    const decoder = new TextDecoder("utf-8");
    let done = false;

    isAILoading.value = false; // Ëß£Èô§Âä†ËΩΩ

    tempChangeBallColor();


    while (!done) {
      const {value, done: readerDone} = await reader.read();
      done = readerDone;

      if (value) {
        // Ëß£Á†ÅÊï∞ÊçÆÂùóÂπ∂ÊåâË°åÂàÜÂâ≤
        const chunk = decoder.decode(value, {stream: true});
        // console.log("chunk",chunk);
        const lines = chunk.split("\n");

        // ÈÄêË°åËß£ÊûêÂπ∂Â§ÑÁêÜ
        lines.forEach((line) => {
          if (line.trim()) { // ÂøΩÁï•Á©∫Ë°å
            try {
              const parsedChunk = JSON.parse(line);
              asks.value[asks.value.length - 1].ai.text += parsedChunk.response;
              expandedMessage.value += parsedChunk.response;
            } catch (parseError) {
              console.warn("JSONËß£ÊûêÂ§±Ë¥•ÔºåË∑≥ËøáËØ•Ë°å: ", line);
            }
          }
        });
      }
    }
    stopScaling();//ÂÅúÊ≠¢ÊäñÂä®
    await expandBall();


    console.log("ÊµÅÁªìÊùü");
  } catch (error) {
    console.error("ÈîôËØØ: ", error);
    asks.value.pop(); //Áõ¥Êé•Âà†ÂéªÊúÄÂêé‰∏Ä‰∏™
    await revertBall();
    if (error.message === "ËØ∑Ê±ÇË∂ÖÊó∂") {
      ErrorPop("Timeout");
      stopScaling();
    } else {
      ErrorPop("404 Warning");
      stopScaling();
    }
  }
};

//ÈîôËØØÂºπÁ™ó
const ErrorPop = (info: string, time = 3000) => {
  ElMessage({
    showClose: true,
    message: info,
    type: 'error',
    duration: time
  })
}


//Âä®ÊÄÅÊïàÊûúÁöÑÂÆûÁé∞
let expandedMessageTip = false;
let expandedMessage = ref("");

// ÂàùÂßãÂåñ MarkdownIt ÂÆû‰æã
const md = new MarkdownIt();
const renderedText = (text: string) => {
  return md.render(text);
};

// ÂÆö‰πâÂìçÂ∫îÂºèÂèòÈáè
const ball = ref(null);
const expandedMessageDiv = ref(null);
const messageInput = ref(null);
const isBallWobbling = ref(true);
const showPetals = ref(true);
let scalingTween = null; // Áî®Êù•Â≠òÊîæÁªºÁº©Âä®ÁîªÁöÑÂèÇËÄÉ

// ÂèëÈÄÅÊ∂àÊÅØÁöÑÊäñÂä®ÊïàÊûú
const sendCartoon = (text: string) => {
  if (text.trim() === '') return;

  const inputBox = messageInput.value.getBoundingClientRect();
  const ballBox = ball.value.getBoundingClientRect();

  const messageClone = document.createElement('div');
  messageClone.innerText = text;
  messageClone.style.position = 'fixed';
  messageClone.style.left = `${inputBox.left + inputBox.width / 2}px`;
  messageClone.style.top = `${inputBox.top}px`;
  messageClone.style.transform = 'translate(-50%, -50%)';
  messageClone.style.whiteSpace = 'nowrap';
  messageClone.style.background = 'rgba(255, 255, 255, 0.8)';
  messageClone.style.padding = '5px';
  messageClone.style.borderRadius = '5px';
  document.body.appendChild(messageClone);

  gsap.to(messageClone, {
    x: ballBox.left + ballBox.width / 2 - (inputBox.left + inputBox.width / 2),
    y: ballBox.top + ballBox.height / 2 - inputBox.top,
    scale: 0.2,
    duration: 1,
    ease: 'power2.inOut',
    onComplete: () => {
      document.body.removeChild(messageClone);
      const tl = gsap.timeline();
      tl.to(ball.value, {scale: 1.3, duration: 0.6, ease: 'power1.inOut'})
          .to(ball.value, {scale: 1, duration: 0.6, ease: 'elastic.out(1, 0.4)'})
          .to(ball.value, {backgroundColor: getRandomHarmoniousColor(0), duration: 1});

    }
  });
  return;
};

// Ëé∑ÂèñÂíåË∞êÈ¢úËâ≤
const getRandomHarmoniousColor = (i:number) => {
  const colors = [['#e8cd3c', '#c24a1e', '#e1a941', '#cb533e', '#FF8C00'], ['#1e90ff', '#288cec', '#3289da', '#3c85c7', '#4682b4']];

  return colors[i][Math.floor(Math.random() * 5)];
};

// ‰∏∫Ëä±Áì£Â∫îÁî®Âä®Áîª
const applyPetalAnimation = (i:number) => {
  if (!ball.value) return; // Á°Æ‰øù ball Â∑≤ÁªèÂàùÂßãÂåñ
  const petals = ball.value.querySelectorAll('.petal');
  petals.forEach((petal, index) => {
    gsap.to(petal, {
      rotation: 360,
      x: 'random(-80, 80)',
      y: 'random(-80, 80)',
      backgroundColor: getRandomHarmoniousColor(i),
      duration: 3,
      repeat: -1,
      yoyo: true,
      ease: 'sine.inOut',
      delay: index * 0.5
    });
  });
};

// ÂºÄÂßãÁªºÁº©ÁöÑÂä®Áîª
const startScaling = () => {
  if (scalingTween) return; // Â¶ÇÊûúÂ∑≤ÁªèÂú®ÁªºÁº©‰∏≠ÔºåÂàô‰∏çÈáçÂ§çÂºÄÂßã
  scalingTween = gsap.to(ball.value, {
    scale: 1.3,
    repeat: -1,
    yoyo: true,
    duration: 1.,
    ease: 'power1.inOut'
  });
};

// ÂÅúÊ≠¢ÁªºÁº©Âä®Áîª
const stopScaling = () => {
  if (scalingTween) {
    scalingTween.kill();
    scalingTween = null;
  }
  gsap.to(ball.value, {
    scale: 1,
    duration: 0.5,
    ease: 'power2.out'
  });
};

// Êâ©Â±ïÊÇ¨ÊµÆÁêÉÁöÑÂä®Áîª
const expandBall = async () => {
  showPetals.value = false; // ÈöêËóèËä±Áì£
  expandedMessageTip = true; // ÊòæÁ§∫Êâ©Â±ïÂêéÁöÑÊ∂àÊÅØ
  sendChange(); // ÊîπÂèòÊ†∑Âºè

  // Á≠âÂæÖ DOM Êõ¥Êñ∞Ôºå‰ª•Á°Æ‰øù expandedMessageDiv ÂèØ‰ª•Ë¢´ËÆøÈóÆÂπ∂Ê∏≤Êüì
  await nextTick();

  if (expandedMessageDiv.value) {
    // ‰ΩøÁî® expandedMessageDiv Ëé∑ÂèñÂÆûÈôÖÊ∏≤ÊüìÂêéÁöÑÈ´òÂ∫¶
    const calculatedHeight = expandedMessageDiv.value.getBoundingClientRect().height;

    // Êâ©Â±ïÊÇ¨ÊµÆÁêÉÁöÑÈ´òÂ∫¶‰ª•ÈÄÇÂ∫îÂÜÖÂÆπ
    gsap.to(ball.value, {
      width: '700px',  // Êâ©Â±ïÂÆΩÂ∫¶
      height: calculatedHeight +  'px', // Âä†‰∏ä‰∏Ä‰∫õ padding ‰ª•Èò≤Ê≠¢ÂÜÖÂÆπÁ¥ßË¥¥ËæπÁºò
      borderRadius: '20px',
      background: '#FFFFFF',
      duration: 1.5,
      ease: 'power1.inOut',
    });
  }
};

// ÁõëÂê¨ expandedMessage ÁöÑÂèòÂåñ
watch(expandedMessage, () => {
  if (expandedMessageTip) {
    updateBallHeight(); // ÂΩìÂÜÖÂÆπÊõ¥Êñ∞Êó∂ÔºåÊõ¥Êñ∞ÊÇ¨ÊµÆÁêÉÁöÑÈ´òÂ∫¶
  }
});

// Âä®ÊÄÅÊõ¥Êñ∞ÊÇ¨ÊµÆÁêÉÁöÑÈ´òÂ∫¶‰ª•ÈÄÇÂ∫îÂÜÖÂÆπ
const updateBallHeight = async () => {
  await nextTick(); // Á≠âÂæÖ DOM Êõ¥Êñ∞Ôºå‰ª•Á°Æ‰øù expandedMessageDiv ÂèØ‰ª•Ë¢´ËÆøÈóÆ

  if (expandedMessageDiv.value) {
    // ÂàõÂª∫‰∏Ä‰∏™‰∏¥Êó∂ÁöÑÂÆπÂô®Áî®‰∫éËÆ°ÁÆóÂÜÖÂÆπÁöÑÈ´òÂ∫¶
    const tempDiv = document.createElement('div');
    tempDiv.style.position = 'absolute';
    tempDiv.style.width = '200px'; // ‰ΩøÁî®‰∏éÊÇ¨ÊµÆÁêÉÁõ∏ÂêåÁöÑÂõ∫ÂÆöÂÆΩÂ∫¶
    tempDiv.style.visibility = 'hidden';
    tempDiv.style.pointerEvents = 'none';
    tempDiv.innerHTML = expandedMessage.value; // ‰ΩøÁî® markdown Ê∏≤ÊüìÂêéÁöÑÂÜÖÂÆπ

    // Â∞Ü tempDiv Ê∑ªÂä†Âà∞ DOM ‰∏≠‰ª•‰æøËÆ°ÁÆó
    document.body.appendChild(tempDiv);

    // Ëé∑Âèñ‰∏¥Êó∂ÂÆπÂô®ÁöÑÈ´òÂ∫¶
    let calculatedHeight = tempDiv.getBoundingClientRect().height;

    // ÁßªÈô§‰∏¥Êó∂ÂÆπÂô®
    document.body.removeChild(tempDiv);

    // Êâ©Â±ïÊÇ¨ÊµÆÁêÉÁöÑÈ´òÂ∫¶‰ª•ÈÄÇÂ∫îÂÜÖÂÆπ
    if (calculatedHeight <= 10) calculatedHeight = 10;
    gsap.to(ball.value, {
      width: '500px',
      height: calculatedHeight + 'px', // Âä†‰∏Ä‰∫õ padding ‰ª•Èò≤Ê≠¢ÂÜÖÂÆπÁ¥ßË¥¥ËæπÁºò
      borderRadius: '20px',
      backgroundColor: '#FFFFFF',
      duration: 1.5,
      ease: 'power2.inOut'
    });
  }
};

// ÊÅ¢Â§çÊÇ¨ÊµÆÁêÉÁöÑÂä®Áîª
const revertBall = async () => {
  showPetals.value = true; // ÊòæÁ§∫Ëä±Áì£
  expandedMessageTip = false; // ÈöêËóèÊâ©Â±ïÁöÑÊ∂àÊÅØ
  expandedMessage.value = "";//ÈîÄÊØÅ‰ø°ÊÅØ
  await nextTick(); // Á≠âÂæÖ DOM Êõ¥Êñ∞

  gsap.to(ball.value, {
    width: '150px',
    height: '150px',
    borderRadius: '50%',
    background: 'radial-gradient(circle at center, rgba(255, 255, 200, 0.8), rgba(255, 140, 0, 0.5)), radial-gradient(circle at center, #FFD700, #FF4500, #FFA500)',
    duration: 1.5,
    ease: 'power1.inOut',
    onComplete: () => {
      applyPetalAnimation(0); // ÈáçÊñ∞Â∫îÁî®Ëä±Áì£Âä®Áîª
    }
  });
};

// ‰ΩøÁî® GSAP Âú®ÁªÑ‰ª∂Âä†ËΩΩÊó∂‰∏∫ÊµÆÂä®ÁêÉÂíåËä±Áì£Ê∑ªÂä†Âä®Áîª
onMounted(() => {
  watch(isBallWobbling, (newValue) => {
    if (newValue) {
      gsap.to(ball.value, {
        y: -30,
        repeat: -1,
        yoyo: true,
        duration: 3,
        ease: 'power1.inOut'
      });
    } else {
      gsap.killTweensOf(ball.value);
      gsap.set(ball.value, {y: 0});
    }
  }, {immediate: true});

  gsap.to(ball.value, {
    boxShadow: '0 0 30px 20px rgba(255, 200, 0, 0.5)',
    repeat: -1,
    yoyo: true,
    duration: 2,
    ease: 'sine.inOut'
  });

  applyPetalAnimation(0); // ÂàùÂßãËä±Áì£Âä®Áîª

});

//Ëé∑Âèñbase url
const stateStore = useStateStore();
let baseURL = ""
onBeforeMount(() => {
  baseURL = stateStore.baseUrl; //ÂÖàËÆæÁΩÆÊàêÈªòËÆ§url
});

// ‰∏¥Êó∂ÊîπÂèòÊÇ¨ÊµÆÁêÉÈ¢úËâ≤
const tempChangeBallColor = () => {
  gsap.to(ball.value, {
    background: 'radial-gradient(circle at center, rgba(173, 216, 230, 0.8), rgba(70, 130, 180, 0.8)), radial-gradient(circle at center, #87CEEB, #4682B4, #1E90FF)', // ËÆæÁΩÆ‰∏Ä‰∏™ËìùËâ≤Ê∏êÂèòÈ¢úËâ≤
    duration: 0.5,
    ease: 'power1.inOut',
    onComplete: () => {
      applyPetalAnimation(1); // ÈáçÊñ∞Â∫îÁî®Ëä±Áì£Âä®Áîª
    }
  });

};

//Âà†Èô§‰ø°ÊÅØ
import {ElMessageBox} from 'element-plus';

const handleDoubleClick = (index: number) => {
  // ÂºπÂá∫Á°ÆËÆ§Ê°Ü
  ElMessageBox.confirm('Are you sure you want to delete this question?', 'Delete Confirmation', {
    confirmButtonText: 'Yes',
    cancelButtonText: 'No',
    type: 'warning'
  }).then(() => {
    // Â¶ÇÊûúÁî®Êà∑ÁÇπÂáªÁ°ÆËÆ§ÔºåÂà†Èô§ÂØπÂ∫îÁöÑ ask
    asks.value.splice(index, 1);
    // Ê∏ÖÁ©∫ÊòæÁ§∫ÁöÑ ai ÂõûÂ§ç
    showHTML.value = '';
  }).catch(() => {
    // Â¶ÇÊûúÁî®Êà∑ÁÇπÂáªÂèñÊ∂àÔºå‰ªÄ‰πàÈÉΩ‰∏çÂÅö
    console.log('Deletion cancelled');
  });
};

//ÂèëÈÄÅÊåâÈíÆÁöÑÈÄªËæë
let sendIcon = ref(Promotion);
let sendColor = ref('success')
const sendNormal = () => {
  sendIcon.value = Promotion;
  sendColor.value = 'success'
}

const sendChange = () => {
  sendIcon.value = Close;
  sendColor.value = 'warning'
}


//Êñá‰ª∂ÊåâÈíÆÁöÑÈÄªËæë
let fileIcon = ref(Picture);
let fileColor = ref('primary')
const fileNormal = () => {
  fileIcon.value = Picture;
  fileColor.value = 'primary'
}

const fileDelete = () => {
  fileIcon.value = Delete;
  fileColor.value = 'danger'
}


// ÂìçÂ∫îÂºèÊï∞ÊçÆÔºåÂ≠òÂÇ®ÂõæÁâáÁöÑ URL
const imageUrl = ref('');

// ‰ΩøÁî® ref Ëé∑ÂèñÊñá‰ª∂ËæìÂÖ•Ê°Ü
const fileInput = ref(null);

// ÊâãÂä®Ëß¶ÂèëÊñá‰ª∂ÈÄâÊã©Ê°Ü
const triggerFileInput = () => {
  // Â¶ÇÊûúÊúâimgÂ∞±Âà†Èô§
  if (imageUrl.value) {
    imageUrl.value = "";
    fileNormal();
    return;
  }
  fileInput.value.click(); // Ëß¶ÂèëÈöêËóèÁöÑÊñá‰ª∂ËæìÂÖ•Ê°Ü
};

// Â§ÑÁêÜÊñá‰ª∂ÈÄâÊã©
const onFileChange = (event) => {
  const file = event.target.files[0]; // Ëé∑ÂèñÈÄâ‰∏≠ÁöÑÊñá‰ª∂
  if (file) {
    const reader = new FileReader(); // ÂàõÂª∫ FileReader ÂÆû‰æã
    reader.onload = (e) => {
      imageUrl.value = e.target.result; // ÂõæÁâáËØªÂèñÂÆåÊàêÂêéËÆæÁΩÆ imageUrl ‰∏∫Êñá‰ª∂ÂÜÖÂÆπÔºàbase64 ÁºñÁ†ÅÔºâ
      fileDelete();
      console.log(imageUrl.value);
    };
    reader.readAsDataURL(file); // Â∞ÜÊñá‰ª∂ËØªÂèñ‰∏∫ Data URLÔºàbase64 ÁºñÁ†ÅÔºâ

    // ÈáçÁΩÆÊñá‰ª∂ËæìÂÖ•Ê°ÜÁöÑÂÄºÔºåËøôÊ†∑Âç≥‰ΩøÈÄâÊã©Áõ∏ÂêåÁöÑÊñá‰ª∂‰πüËÉΩËß¶Âèë change ‰∫ã‰ª∂
    event.target.value = '';
  }
};

//ÂõûËΩ¶ÂèëÈÄÅ
const handleKeyDown = (event: KeyboardEvent) => {
  if (event.key === 'Enter') {
    sendToModel();
  }
};

//ÊÇ¨ÊµÆÁ™óÊøÄÊ¥ª
function openFloating() {

  window.electronAPI.openFloatingWindow();
  console.log("Â∑≤Êåâ‰∏ã");
}

</script>
<style scoped>
.chat-page {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start; /* Ë∞ÉÊï¥‰∏∫ flex-startÔºå‰ΩøÂÜÖÂÆπÂêë‰∏äÂØπÈΩê */
  height: 100vh;
  padding: 180px 20px 20px; /* ÂáèÂ∞èÈ°∂ÈÉ®ÁöÑ paddingÔºå‰ΩøÂÜÖÂÆπÂêë‰∏äÁßªÂä® */
  background-color: #8fefdd;
}

/* ÂÖ∂‰ªñÊ†∑Âºè‰øùÊåÅ‰∏çÂèò */


/* ÊÇ¨ÊµÆÁêÉÊ†∑Âºè */
.float-ball {
  width: 150px; /* Âõ∫ÂÆöÂÆΩÂ∫¶ */
  height: 150px;
  border-radius: 50%;
  background: radial-gradient(circle at center, rgba(255, 255, 200, 0.8), rgba(255, 140, 0, 0.5)), radial-gradient(circle at center, #FFD700, #FF4500, #FFA500);
  margin: 50px auto;
  box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);
  position: relative;
  overflow-y: scroll;
  scrollbar-width: none;  /* ÈöêËóèÊªöÂä®Êù° */
}

.past-info {
  display: flex;
  flex-wrap: wrap;
  max-width: 80%;
  margin-top: 10px;
  gap: 10px;
  overflow-y: hidden;
  max-height: 200px;
}

/* ËæìÂÖ•Ê°ÜÂÆπÂô® */
.input-container {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  max-width: 600px;
  padding: 10px;
  border-radius: 20px;
  background-color: #f5f5f5;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  margin-top: 10px;
}

.message-input {
  flex: 1;
  padding: 10px;
  border: none;
  border-radius: 20px;
  font-size: 16px;
  outline: none;
  background-color: transparent;
}

.question-bubble {
  padding: 8px 15px;
  background-color: #e0f7fa;
  border-radius: 10px;
  cursor: pointer;
}

.dropdown-button {
  margin-left: 8px;
}

.petal {
  width: 40px;
  height: 40px;
  background: rgba(255, 200, 0, 0.6);
  border-radius: 50%;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.expanded-message {
  color: #000;
  text-align: left;
  padding: 20px; /* Âä†ÂÖ•‰∏Ä‰∫õÂÜÖËæπË∑ù */
  font-size: 1.2em;
}

.markdown-body {
  box-sizing: border-box;
  min-width: 200px;
  max-width: 980px;
  margin: 0 auto;
  padding: 15px;
  width: 700px;
}

@media (max-width: 767px) {
  .markdown-body {
    padding: 15px;
  }
}

img {
  margin-top: 10px;
  width: 80px; /* Âõ∫ÂÆöÂÆΩÂ∫¶ */
  height: auto; /* ‰øùÊåÅÊØî‰æã */
  margin-left: 10px;
  border-radius: 20px;
  margin-right: 10px;
}


</style>